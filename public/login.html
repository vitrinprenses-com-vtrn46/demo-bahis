<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Demo Bahis GiriÅŸi</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { font-family: Arial; background:#f4f4f4; padding:20px }
.container { max-width: 400px; margin-top: 50px; }
input, button { margin-bottom:10px; }
</style>
</head>
<body>
<div class="container">

<h2>ğŸ” KullanÄ±cÄ± GiriÅŸi</h2>
<input id="u" class="form-control" placeholder="KullanÄ±cÄ± AdÄ±">
<input id="p" type="password" class="form-control" placeholder="Åifre">
<button id="loginBtn" class="btn btn-primary w-100" type="button">GiriÅŸ Yap</button>

<hr>

<h2>ğŸ“ Yeni KullanÄ±cÄ± KaydÄ±</h2>
<input id="regUsername" class="form-control" placeholder="KullanÄ±cÄ± AdÄ±">
<input id="regPassword" type="password" class="form-control" placeholder="Åifre">
<button id="registerBtn" class="btn btn-success w-100" type="button">KayÄ±t Ol</button>

</div>

<script>
const db = require("./database");
const bcrypt = require("bcryptjs");

(async () => {
  const hash = await bcrypt.hash("123456", 10);
  db.run("INSERT INTO users (username, password) VALUES (?, ?)", ["testuser", hash], function(err){
    if(err) console.log(err); else console.log("Test kullanÄ±cÄ± oluÅŸturuldu âœ…");
  });
})();


const loginBtn = document.getElementById("loginBtn");
const registerBtn = document.getElementById("registerBtn");

// GiriÅŸ
loginBtn.addEventListener("click", async () => {
  const username = document.getElementById("u").value;
  const password = document.getElementById("p").value;
  if(!username || !password) return alert("KullanÄ±cÄ± adÄ± ve ÅŸifre girin!");

  const res = await fetch("/auth/login", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({username,password})
  });

  const data = await res.json();
  if(data.token){
    localStorage.setItem("token", data.token);
    location.href = "/index.html"; 
  } else alert(data.error);
});

// KayÄ±t
registerBtn.addEventListener("click", async () => {
  const username = document.getElementById("regUsername").value;
  const password = document.getElementById("regPassword").value;
  if(!username || !password) return alert("KullanÄ±cÄ± adÄ± ve ÅŸifre girin!");

  const res = await fetch("/auth/register", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({username,password})
  });

  const data = await res.json();
  alert(data.message || data.error);
});
</script>
</body>
</html>
